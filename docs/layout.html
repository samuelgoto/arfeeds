<html>
  <head>
    <script src="https://aframe.io/releases/0.8.0/aframe.min.js"></script>
  </head>
  <body>

<!--
    <a-scene>
      <a-box position="0 0 -10" rotation="0 0 0" color="#4CC3D9">
      </a-box>
      <a-text color="#000000" position="1 0 -10" value="hello world"></a-text>
      <a-entity position="0 0 0" rotation="0 0 0">
        <a-camera fov="10" zoom="1"></a-camera>
      </a-entity>
    </a-scene>
-->

  <script>
AFRAME.registerComponent("layout", {
  schema: {
    camera: {type: "string", default: "camera"},
    message: {type: "string", default: "Hello, World!"},
    width: {type: "number", default: 1},
    height: {type: "number", default: 1},
    depth: {type: "number", default: 1},
    x: {type: "number", default: 0},
    y: {type: "number", default: 0},
    z: {type: "number", default: 0},
    color: {type: "color", default: "#4CC3D9"}
  },
  init: function () {
    // console.log();
    let camera = document.getElementById(this.data.camera);
    camera.setAttribute("position", {
      x: this.data.width / 2,
      y: this.data.height / 2,
      z: 10
    });
  },
  update: function() {
    // console.log("updating");
    // console.log(this.el);

    this.el.setAttribute("material", {
      transparent: true,
      opacity: 0.1,
      color: "#4CC3D9"
    });

    this.el.setAttribute("geometry", {
      primitive: "box",
      depth: this.data.depth,
      width: this.data.width,
      height: this.data.height
    });

    this.el.setAttribute("position", {
      x: this.data.width / 2,
      y: this.data.height / 2,
      z: this.data.depth / 2
    });

    // console.log("init");
    // console.log(this.data.message);
    // console.log(this.el);
    // let x = - this.data.width / 2;
    // let y = this.data.height / 2;
    let x = 0;
    let y = 0;
    let max = 0;
    for (let child of this.el.children) {
      let geometry = child.getAttribute("geometry");
      let position = child.getAttribute("position");

      console.log(`position(${x}, ${y}) size(${geometry.width}, ${geometry.height})`);

      max = Math.max(max, geometry.height);

      // console.log(`${}`);
      if ((x + geometry.width) > this.data.width) {
        console.log(`block does not fit`);
        x = 0;
        // goes to the next line.
        y -= max;
      }

      x += geometry.width / 2;
      y -= geometry.height / 2;

      // container(${this.data.width}, ${this.data.height})
      position.x = (-this.data.width / 2) + x;
      position.y = (this.data.height / 2) + y;

      x += geometry.width / 2;
      y += geometry.height / 2;
      // console.log(geometry);
    }

  },
  remove: function() {
    // console.log("removing");
  }
});
  </script>

  <a-scene>
    <a-entity layout="width: 3; height: 3; camera: camera;">
      <a-entity geometry="primitive: box" material="color:#000"></a-entity>
      <a-entity geometry="primitive: box" material="color:#111"></a-entity>
      <a-entity geometry="primitive: box" material="color:#222"></a-entity>
      <a-entity geometry="primitive: box" material="color:#333"></a-entity>
      <a-entity geometry="primitive: box" material="color:#444"></a-entity>
      <a-entity geometry="primitive: box" material="color:#555"></a-entity>
      <a-entity geometry="primitive: box" material="color:#666"></a-entity>
      <a-entity geometry="primitive: box" material="color:#777"></a-entity>
    </a-entity>

    <a-entity id="camera">
      <a-camera fov="20" zoom="1"></a-camera>
    </a-entity>

  </a-scene>

  </body>
</html>
